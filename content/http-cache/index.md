---
emoji: HTTP
title: HTTP Cache가 뭔가요?
date: '2022-08-30 23:00:00'
author: aaron
tags: http cache network
categories: 개발
---

![](https://statuscode.space/304.jpg)
__Photo by STATUSCODE.SPACE__

네트워크 상에서 무언가를 요청하여 가져 오는것은 비용이 많이 드는 작업입니다.
특히나 응답의 크기가 클 때 사용자가 정보를 확인하기 위해 오래 기다려야 하는 등 시간적 자원과, 데이터에 크기에 따른 물리적인 자원(💸)이 소모됩니다. 이를 잘 해결하고, 사용자에게 최적의 경험을 주기 위해서는 코드 단에서 과한 데이터 요청과 불필요한 데이터 요청을 방지하는 것도 중요하지만 적절한 HTTP Cache 정책을 세워 이를 방지할 수 있습니다. 어떻게 하면 적절한 Cache 정책을 사용하여 이를 해결할 수 있을까요?

HTTP Cache의 경우 정책을 제대로 고려하지 않는다면 여러가지 문제가 발생할 수 있습니다. 먼저 너무 짧은 캐시 유효기간 때문에 여전히 불필요 하게 많은 HTTP 요청을 보낼 수 있습니다. 또는 **너무 긴 유효기간 때문에 원하는 시점에 캐시가 사라지지 않아 사용자가 여전히 오래된 정보를 확인하고 있을 수 있습니다.** 이는 치명적인 문제로, 사용자는 심지어 무엇이 잘못된것인지 조차 모를 수 있습니다.

이러한 캐시 정책을 잘 세우기 위해서 HTTP 헤더에 다음과 같은 속성을 추가할 수 있습니다.

### 1. Cache-Control

일반적으로 캐시는 GET 요청에 대해서 작동하며 대표적으로 서버에서 HTTP Response의 헤더에 `Cache-Control` 속성을 추가 함으로써 제어할 수 있습니다. 가장 할 이야기가 많은 헤더입니다.

#### 1. 캐시의 유효기간
캐시의 유효기간을 설정하여 클라이언트가 언제까지 캐시를 저장하고 사용하게 할지 결정할 수 있습니다.
브라우저에 저장된 캐시는 서버에서 임의로 제거하기 어렵기 때문에 유효기간 설정은 신중해야 합니다.

- **max-age={seconds}**
{seconds}만큼 브라우저에 저장될 캐시의 유효기간을 설정합니다. 해당 유효기간 만큼 브라우저는 서버에 요청을 보내지 않고, 메모리에 저장된 캐시를 사용하여 서버의 응답을 대체하여 사용자에>게 노출합니다.
- **s-maxage={seconds}**
{seconds}만큼 중간서버에 저장될 캐시의 유효기간을 설정합니다. 예를들어 CDN에 저장될 캐시의 유효기간을 지정할 수 있습니다.

캐시의 유효기간이 만료된다고 해서 저장된 캐시가 삭제되는것은 아닙니다. 다만 클라이언트 에서 캐시가 여전히 유효한지 재검증 요청을 보내게 됩니다.

> 예) `'Cache-Control': 'max-age=0, s-maxage=31536000'` 을 설정하게 되면 중간 서버 에서는 31,536,000초(1년) 동안의 유효기간을 가지게 되고, 클라이언트는 캐시는 저장하되, 매번 재검증 요청을 보내어 캐시가 신선한 것인지 파악 합니다.

#### 2. Private | Public
`private`과 `public` 속성을 통해 우리의 캐시를 최 끝단 사용자 클라이언트에만 저장할지, 중간 캐시 서버에도 저장할지를 선택할 수 있습니다. 이러한 속성 부여가 필요한 경우는 대표적으로 사용자 개인적인 정보를 포함하는 경우가 있는데, 여러 사용자에게 공통된 캐시를 제공할 수 있는 중간 캐시 서버에도 저장할지, 완벽히 개인화된 사용자 클라이언트에만 저장할지 판단하여 사용할 수 있습니다.

> 예) `'Cache-Control': 'private, max-age=600'` 의 경우 사용자 클라이언트에만 10분동안 유효한 캐시를 저장하게 됩니다.

max-age 속성을 부여하는것 만으로도 어떠한 곳 에서든 캐시 저장이 가능하다고 나타내는 것이 됨으로 `public` 속성의 경우 명시적으로 작성할 필요는 없습니다.

#### 3. No-Cache | No-Store
가장 많이 헷갈려할 수 있는 부분이라 생각되며, 최초 작명이 이렇게 중요하고 또 나중엔 얼마나 고치기 힘든지 보여주는 예라고 생각합니다.

- **no-cache**
no cache! 라고 해서 캐시를 사용하지 않겠다는 말이 아닙니다. 캐시는 저장하지만 **저장된 캐시 데이터를 사용하고자 할 때 마다 서버에 캐시를 사용해도 좋은지 검증 요청을 하게 됩니다.** 대부분의 브라우저에서 `max-age=0` 과 같은 뜻을 가집니다.

- **no-store**
no store 속성이야 말로, cache store를 사용하지 않겠다. 즉 캐시를 저장도 하지 않겠다 라는 말이 됩니다.
**해당 속성을 사용하면 브라우저는 어떠한 경우에도 캐시 저장소에 해당 리소스를 저장하지 않습니다.**

#### 4. must-revalidate
`must-revalidate` 속성은 캐시 만료 후 컨텐츠의 출처가 되는 원 서버에 캐시 데이터를 사용해도 되는지 반드시 확인하는 절차를 추가하는 속성입니다.

_...그렇다면 위에서 설명한 'no-cache'와 어떠한 차이 일까요?_
- `no-cache` 는 캐시의 만료 시간이 지나지 않아도 서버에 검증 요청을 함
- `must-revalidate` 는 캐시의 유효 기간이 만료 되었을때 서버에 검증 요청을 함 을 차이점으로 둔다고 말할 수 있을것 같습니다.
많이 헷갈릴 수 있는 부분이지만 개인적으로 [stackoverflow에 이해가 잘 되는 글](https://stackoverflow.com/questions/18148884/difference-between-no-cache-and-must-revalidate)이 있어 해당 글을 보고 이해할 수 있었습니다.

보통의 경우 완전한 캐시 사용의 무효화를 위하여
`'Cache-Control': 'no-cache, no-store, must-revalidate'` 와 같이 작성 하는데, 비슷한 역할을 하는 속성을 나열하는 이유는 여러 브라우저 프로토콜 버전등에 대한 대응이라 생각하면 좋을것 >같습니다.
HTTP/1.0의 하위 호환을 위해서는 아래 언급할 `Pagma: 'no-cache'`도 포함할 수 있을것 같습니다.

### 2. Expires

응답 컨텐츠가 만료될 시간을 정확히 제어할 수도 있습니다. Cache-Control에 max-age 속성값이 존재할 경우 Expires는 무시됩니다.

> 예) Expires: Thu, 26 Jul 2018 07:28:00 GMT

### 3. Pagma
Pagma 속성은 HTTP/1.0 에서 Cache-Control의 역할을 대신하던 속성 이고, 특별한 경우가 없다면 현재 서비스를 구현 하는데 있어 중요하지 않고 이런것이 있다 정도만 알고 있으면 될것 같습니다. 이에 아래 MDN 인용구로 설명을 대체합니다.

>`Pragma` 는 HTTP 응답에서 명시되지 않았던 헤더여서 일반적인 HTTP/1.1 의 `Cache-Control` 헤더의 신뢰할만한 대체재로 사용될수는 없다. 비록 그것이 응답에서  `Cache-Control` 헤더가 생략>되었을 시, `Cache-Control: no-cache` 와 동일하게 효과를 주긴 하지만 말이다. `Pragma` 헤더는 HTTP/1.0 를 사용하는 클라이언트들만을 위한 비공식적인 호환성을 위해서 사용하는것이 옳다.
>
Refs: https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Pragma

### 8. 드디어 마치며...
위의 설명과 같이 사실 HTTP Cache는 하나의 API로써 동작하는 것이 아닙니다.
더이상 잘 사용되지 않는 `Expires` `Pagama` 는 제외 하더라도, 리소스를 관리하는 header들은 `ETag` `Last-Modified` 와 같이 더 존재 합니다. Cache 정책을 잘 정할 수록 사용자와 서비스 제공자 모두에게 좋은 효과를 줄 수 있으니, 우리 모두 캐시를 공부 합시다.

아래는 위에서 등장 했던 속성들을 결정하는 플로우 차트 입니다.
![](https://velog.velcdn.com/images/likegecko/post/a069e6d1-ae7c-4051-8b56-20b983fca233/image.png)

```toc
```
